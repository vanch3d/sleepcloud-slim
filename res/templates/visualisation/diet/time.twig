{% extends 'base.twig' %}

{% block title %}Diet | Time{% endblock %}

{% block content %}
    <div id="controller" class="d-flex p-2 flex-row" style="width: 100%;">
        <div id="data-picker"></div>
    </div>
    <div id="chart" style="width: 100%;">

    </div>
{% endblock %}

{% block injectCSS %}
    <style>
        rect.bordered {
            stroke: #E6E6E6;
            stroke-width:2px;
        }

        text.mono {
            font-size: 9pt;
            font-family: Consolas, courier;
            fill: #aaa;
        }

        text.axis-workweek {
            fill: #000;
        }

        text.axis-worktime {
            fill: #000;
        }
    </style>

{% endblock %}

{% block injectJS %}
<script src="/js/d3.v4-bundle.min.js" ></script>
<script>
    $(document).ready(function() {

        let url = "{{ path_for('api.diet.records') }}";
        d3.json(url, function(error, json) {
            console.log(json.data);

            //let formatDay = d3.timeFormat("%Y-%m-%d");
            let formatHour = d3.timeFormat("%H");
            let byDay = d3.nest()
                .key(function(d) { return ((new Date(d.date)).getDay() || 7) -1; })
                .key(function(h) { return formatHour(new Date(h.date)); })
                .rollup(function(v) { return v.length; })
                .entries(json.data);
            console.log(byDay);

            let chart = d3.chart.weeklyHeatMap();
            d3.select('#chart')
                .datum(byDay)
                .call(chart);
        });

    });
</script>
{% endblock %}
